<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DarkCPU: Virtual File System</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="large.png.bkp"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">DarkCPU
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_file_system.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Virtual File System </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Virtual File System (VFS)</h2>
<p>The virtual file system (VFS) module of kernel is responsible for providing a layer of abstraction between the physical structure &amp; interface of the underlying filesystem device and the software accessing the filesystem. This layer of abstraction is used to allow any module running over the kernel or for the kernel itself to access the filesystem where the specific details of the filesystem or storage media remain completely transparent in the process of file access.</p>
<p>If a storage media presents a specific filesystem it wishes to give the system access to, it can have its respective filesystem interface library mounted along with the respective storage driver. The filesystem interface and the storage driver are both expected to implement the <a class="el" href="md__standard_drivers.html#DDSSI">DDSSI</a> and DDSFSI interfaces. The filesystem can be mounted to a free mountpoint using the <a class="el" href="vfs-10c_8c.html#a839cb325e4c1c6ebb35fbe2ec53ef0c4">vfs_createMount</a> routine. Once the filesystem has been mounted, its root directory can be accessed via the <a class="el" href="vfs-10c_8c.html#a5b15f7658fbe548d58a57dbea60471dc">vfs_fGetRoot</a> routine.</p>
<h2>File Descriptors</h2>
<p>All files are described using the VFSFile structure in the kernel. This structure is responsible for keeping track of data which describes the open file. Refer to <a class="el" href="_file_system.html#VFSFileLayout">VFSFileLayout</a></p>
<p>This is the libc implementation of FILE*.</p>
<h2>Layout of a VFS Mount Point Entry</h2>
<table class="doxtable">
<tr>
<th>Offset </th><th>Member Name </th><th>Description of Member</th></tr>
<tr>
<td>VFS_MOUNTPOINT_OFFSET_MEDIASTORAGEDRIVER </td><td>pMediaDriver </td><td>Stores a pointer to the media storage driver that handles direct access to the mounted storage device. </td></tr>
<tr>
<td>VFS_MOUNTPOINT_OFFSET_FILESYSTEMDRIVER </td><td>pFilesystemDriver </td><td>Stores a pointer to the file system interface driver that creates an interface between the vft and the storage device. </td></tr>
</table>
<p><a class="anchor" id="VFSFileLayout"></a></p>
<h2>Layout of a VFS File</h2>
<table class="doxtable">
<tr>
<th>Offset </th><th>Member Name </th><th>Description of Member</th></tr>
<tr>
<td>VFS_FILE_OFFSET_FILELENGTH </td><td>pFilesystemDriver </td><td>Stores a pointer to the file system interface driver that creates an interface between the vft and the storage device. </td></tr>
<tr>
<td>VFS_FILE_OFFSET_FILEFLAGS </td><td>dwFileFlags </td><td>Flags which store the state of or describe properties of the file descriptor. Refer to <a class="el" href="_file_system.html#VfsFileFlags">VfsFileFlags</a> </td></tr>
<tr>
<td>VFS_FILE_OFFSET_CURSOR </td><td>dwCursor </td><td>Defines the current read cursor of the file. Where zero is the start of the file, and 'x' is 'x' words from the start of the file. </td></tr>
<tr>
<td>VFS_FILE_OFFSET_FILEIDHI </td><td>dwFileIdHi </td><td>High word of file id. The file id member can be used only internally by the filesystem driver, and in any manner the implementation of the filesystem driver deems useful. </td></tr>
<tr>
<td>VFS_FILE_OFFSET_FILEIDLO </td><td>dwFileIdLo </td><td>Low word of file id. The file id member can be used only internally by the filesystem driver, and in any manner the implementation of the filesystem driver deems useful. </td></tr>
<tr>
<td>VFS_FILE_OFFSET_MOUNTPOINT </td><td>dwMountPoint </td><td>An index describing the mountpoint this file's containing filesystem is mounted on. </td></tr>
<tr>
<td>VFS_FILE_OFFSET_SECTORSIZE </td><td>dwSectorSize </td><td>The size of a single sector of the storage media. </td></tr>
<tr>
<td>VFS_FILE_OFFSET_MEDIAREAD </td><td>pfnMediaRead </td><td>A pointer to the raw media read operation of the underlying storage device </td></tr>
<tr>
<td>VFS_FILE_OFFSET_MEDIAWRITE </td><td>pfnMediaWrite </td><td>A pointer to the raw media write operation of the underlying storage device </td></tr>
</table>
<p><a class="anchor" id="VfsFileFlags"></a></p>
<h2>VFS File Flags</h2>
<table class="doxtable">
<tr>
<th>Flag </th><th>Description</th></tr>
<tr>
<td>VFS_FILE_FILEFLAGS_DIRECTORY </td><td>Set when the file descriptor describes a directory </td></tr>
<tr>
<td>VFS_FILE_FILEFLAGS_EOF </td><td>EOF bit set when the cursor has reached the end of the file </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Jan 19 2013 05:26:25 for DarkCPU by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
